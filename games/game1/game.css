/* Wrapper ensures comfortable margins and safe area spacing */
.game-wrapper {
    padding: clamp(0.5rem, 1.5vw, 1rem) clamp(0.5rem, 1.5vw, 1rem);
    max-width: 960px;
    margin: 0 auto;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: clamp(0.25rem, 0.8vw, 0.75rem); /* Small gap between header and game area - accounted for in flex calculation */
    height: 100vh; /* Fallback for browsers that don't support dvh */
    height: 100dvh; /* Use dynamic viewport height (excludes browser UI on mobile) - overrides vh if supported */
    max-height: 100vh; /* Fallback for browsers that don't support dvh */
    max-height: 100dvh; /* Prevent exceeding viewport - overrides vh if supported */
    box-sizing: border-box; /* Include padding in height calculation */
    overflow: hidden; /* Prevent any overflow - background must stay within viewport */
}

/* Header arranges back button, title, and instructions */
.game-header {
    display: flex;
    flex-direction: column;
    gap: clamp(0.4rem, 1.5vw, 1rem);
    flex-shrink: 0; /* Prevent header from being compressed - it needs its natural height */
    margin: 0; /* No margin - spacing controlled by wrapper gap */
}

.game-header__buttons {
    display: flex;
    justify-content: flex-start;
    align-items: center;
}

.game-header__center {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: clamp(0.3rem, 1vw, 0.6rem);
}

/* Back button uses soft colors and large touch target */
.back-button {
    background: #38bdf8;
    color: #0f172a;
    font-weight: 700;
    padding: 0.6rem 1rem; /* Slightly smaller */
    border-radius: 9999px;
    text-decoration: none;
    font-size: 1.75rem; /* Slightly smaller arrow */
    box-shadow: rgba(0, 0, 0, 0.25) 0 14px 28px, rgba(0, 0, 0, 0.22) 0 10px 10px;
    transition: transform 150ms ease, box-shadow 150ms ease;
}

.back-button:active {
    transform: translateY(2px);
    box-shadow: rgba(0, 0, 0, 0.25) 0 10px 18px, rgba(0, 0, 0, 0.2) 0 6px 6px;
}

.game-title {
    font-size: clamp(1.8rem, 4vw, 3rem);
    font-weight: 800;
    color: #1e1b4b;
}

.game-instructions {
    font-size: clamp(1rem, 2.5vw, 1.4rem);
    font-weight: 600;
    color: #312e81;
    min-height: 1.5em;
}

/* Game area uses relative positioning for circle placement */
.game-area {
    position: relative;
    width: 100%;
    flex: 1; /* Fill remaining space in flex container */
    min-height: 0; /* Allow flex to shrink below content size - critical for fitting viewport */
    min-height: 280px; /* Minimum height for small screens */
    max-height: none; /* Allow flex to determine height based on available space */
    /* Layer a soft gradient over the image so circles stay readable */
    background-image: linear-gradient(180deg, rgba(255, 255, 255, 0.78), rgba(255, 255, 255, 0.38)), url('images/background.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 1.5rem;
    box-shadow: inset 0 0 25px rgba(30, 64, 175, 0.12);
    overflow: hidden;
}

/* Completion dialog overlay */
.completion-dialog {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(15, 23, 42, 0.35);
    backdrop-filter: blur(4px);
    z-index: 40;
}

.completion-dialog[hidden] {
    display: none !important;
}

/* Dialog card styling */
.completion-dialog__content {
    background: linear-gradient(160deg, rgba(255,255,255,0.97), rgba(224,242,254,0.95));
    border-radius: 1.5rem;
    padding: 1.8rem;
    max-width: 320px;
    width: calc(100% - 2.5rem);
    text-align: center;
    box-shadow: 0 18px 36px rgba(30, 64, 175, 0.25);
}

.completion-dialog__image {
    width: 164px;
    height: 164px;
    margin: 0 auto 0.9rem;
    border-radius: 50%;
    overflow: hidden;
    box-shadow: 0 12px 28px rgba(59, 130, 246, 0.25);
}

.completion-dialog__image img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.completion-dialog__title {
    font-size: 1.55rem;
    font-weight: 800;
    color: #1e1b4b;
    margin-bottom: 0.65rem;
}

.completion-dialog__message {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1e3a8a;
    margin-bottom: 1.2rem;
}

.completion-dialog__actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.completion-dialog__btn {
    border: none;
    border-radius: 9999px;
    font-size: 1.1rem;
    font-weight: 700;
    padding: 0.7rem 1rem;
    cursor: pointer;
    transition: transform 120ms ease, box-shadow 120ms ease;
}

.completion-dialog__btn--primary {
    background: linear-gradient(135deg, #34d399, #10b981);
    color: #0f172a;
    box-shadow: rgba(0, 0, 0, 0.25) 0 14px 28px, rgba(0, 0, 0, 0.2) 0 10px 10px;
}

.completion-dialog__btn--secondary {
    background: linear-gradient(135deg, #bfdbfe, #93c5fd);
    color: #1e3a8a;
    box-shadow: rgba(0, 0, 0, 0.25) 0 14px 28px, rgba(0, 0, 0, 0.2) 0 10px 10px;
}

.completion-dialog__btn:active {
    transform: translateY(2px);
    box-shadow: rgba(0, 0, 0, 0.25) 0 10px 18px, rgba(0, 0, 0, 0.2) 0 6px 6px;
}

/* Each circle is absolutely positioned */
/* Playful, bubbly circles */
.circle {
    position: absolute;
    width: clamp(72px, 12vw, 108px);
    height: clamp(72px, 12vw, 108px);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(1.8rem, 5.5vw, 2.75rem);
    font-weight: 800;
    color: #0f172a;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 14px 24px rgba(15, 23, 42, 0.25);
    transition: transform 180ms ease, box-shadow 180ms ease, opacity 180ms ease;
    border: 4px solid rgba(255, 255, 255, 0.45);
    overflow: hidden;
    animation: floaty 7s ease-in-out infinite;
    animation-delay: calc(var(--float-phase, 0) * 1s);
}

.circle::after {
    content: "";
    position: absolute;
    top: 12%;
    left: 22%;
    width: 40%;
    height: 40%;
    background: radial-gradient(circle, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0) 70%);
    border-radius: 50%;
    transform: rotate(-20deg);
    opacity: 0.8;
    pointer-events: none;
}

/* Colourful gradient background for circles */
.circle:nth-child(5n + 1) {
    background: conic-gradient(from 180deg at 50% 50%, #fbbf24 0deg, #f97316 120deg, #fb7185 240deg, #fbbf24 360deg);
    --float-phase: 0.2;
}

.circle:nth-child(5n + 2) {
    background: conic-gradient(from 90deg at 50% 50%, #a855f7 0deg, #22d3ee 140deg, #60a5fa 260deg, #a855f7 360deg);
    --float-phase: 0.6;
}

.circle:nth-child(5n + 3) {
    background: conic-gradient(from 45deg at 50% 50%, #34d399 0deg, #bef264 150deg, #38bdf8 280deg, #34d399 360deg);
    --float-phase: 1.1;
}

.circle:nth-child(5n + 4) {
    background: conic-gradient(from 0deg at 50% 50%, #f472b6 0deg, #f9a8d4 160deg, #facc15 280deg, #f472b6 360deg);
    --float-phase: 1.7;
}

.circle:nth-child(5n) {
    background: conic-gradient(from 270deg at 50% 50%, #22c55e 0deg, #84cc16 130deg, #14b8a6 260deg, #22c55e 360deg);
    --float-phase: 2.3;
}

/* Circle hover feedback for desktop */
.circle:hover {
    transform: scale(1.1) rotate(-2deg);
    box-shadow: 0 18px 26px rgba(14, 116, 144, 0.35);
}

/* Correctly tapped circles gently fade */
.circle.correct {
    background: conic-gradient(from 0deg at 50% 50%, #34d399 0deg, #22d3ee 120deg, #60a5fa 240deg, #34d399 360deg);
    color: #064e3b;
    opacity: 0.9;
    transform: scale(1.05);
    animation: pop-burst 320ms ease-out forwards;
}

/* Responsive adjustments for very small screens */
@media (max-width: 480px) {
    .back-button {
        font-size: 1.2rem; /* Slightly smaller arrow on small screens */
        padding: 0.5rem 0.85rem; /* Slightly smaller padding */
    }

    .timer {
        font-size: 1.3rem;
        padding: 0.6rem 1.2rem;
    }
}

@media (max-width: 640px) {
    .game-header {
        gap: 0.5rem;
    }

    .back-button {
        padding: 0.5rem 0.85rem; /* Slightly smaller padding */
        font-size: 1.5rem; /* Slightly smaller arrow on medium screens */
    }

    .start-button {
        padding: 0.55rem 1.1rem;
        font-size: 1.1rem;
        max-width: 70%;
        min-width: 0;
    }

    .timer {
        padding: 0.55rem 1.1rem;
        font-size: 1.3rem;
    }

    .status-message {
        font-size: 1.1rem;
        margin-bottom: 0.85rem;
    }
}

@keyframes floaty {
    0% { transform: translate(0, 0) scale(1) rotate(0deg); }
    20% { transform: translate(3px, -6px) scale(1.02) rotate(-0.8deg); }
    40% { transform: translate(-4px, 2px) scale(0.99) rotate(0.9deg); }
    60% { transform: translate(5px, -3px) scale(1.01) rotate(-0.5deg); }
    80% { transform: translate(-3px, 4px) scale(1.02) rotate(0.6deg); }
    100% { transform: translate(0, 0) scale(1) rotate(0deg); }
}

@keyframes pop-burst {
    0% { box-shadow: 0 14px 24px rgba(15, 23, 42, 0.25); }
    60% { box-shadow: 0 20px 32px rgba(34, 197, 94, 0.45); }
    100% { box-shadow: 0 12px 18px rgba(15, 23, 42, 0.18); }
}

/* PWA standalone mode - use small viewport height to prevent overflow */
@media (display-mode: standalone) {
    .game-wrapper {
        height: 100vh; /* Fallback for browsers that don't support svh */
        height: 100svh; /* Small viewport height - smallest possible viewport - overrides vh if supported */
        max-height: 100vh; /* Fallback for browsers that don't support svh */
        max-height: 100svh; /* Prevent exceeding viewport - overrides vh if supported */
    }
}

